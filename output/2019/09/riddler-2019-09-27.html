<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <!-- ##### gtm ##### -->
    <script>
        window.dataLayer = window.dataLayer || [];
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TJN5JZ6');</script>
    <!-- End Google Tag Manager -->

  <title>2019-09-27 Riddler</title>


  <link rel="icon" href="theme/assets_images/favicon_jn.png" sizes="32x32" />

  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="../../" rel="canonical" />

  <!-- Feed -->

  <link href="../../theme/css/bootstrap/bootstrap.css" type="text/css" rel="stylesheet" />

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr"
    crossorigin="anonymous">
  <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl"
    crossorigin="anonymous"></script>

  <!-- Code highlight color scheme -->
  <link href="../../theme/css/code_blocks/monokai.css" rel="stylesheet">

  <!-- mathjax -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
     "HTML-CSS": {linebreaks: {automatic: true},
                  scale: 66
                 },
      SVG: {linebreaks: {automatic: true} },
      CommonHTML: {scale: 66}
    });
    </script>

  <!-- CSS specified by the user -->


  <link href="../../theme/css/normalize.css" type="text/css" rel="stylesheet" />


  <link href="../../theme/css/main.css" type="text/css" rel="stylesheet" />

  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


  <link href="../../2019/09/riddler-2019-09-27.html" rel="canonical" />

    <meta name="description" content="Who will win the Riddler Fall Classic?">

    <meta name="author" content="Jordy Nelson">

    <meta name="tags" content="FiveThirtyEight">
    <meta name="tags" content="Riddler">
    <meta name="tags" content="R">
    <meta name="tags" content="probability">
    <meta name="tags" content="negative binomial">
    <meta name="tags" content="simulation">
    <meta name="tags" content="baseball">




<!-- Open Graph -->
<meta property="og:site_name" content="Jordy Nelson"/>
<meta property="og:title" content="2019-09-27 Riddler"/>
<meta property="og:description" content="Who will win the Riddler Fall Classic?"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="../../2019/09/riddler-2019-09-27.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-09-29 14:48:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="../../author/jordy-nelson">
  <meta property="article:publisher" content="https://www.facebook.com/jordy.nelson248" />
<meta property="article:section" content="Riddler"/>
<meta property="article:tag" content="FiveThirtyEight"/>
<meta property="article:tag" content="Riddler"/>
<meta property="article:tag" content="R"/>
<meta property="article:tag" content="probability"/>
<meta property="article:tag" content="negative binomial"/>
<meta property="article:tag" content="simulation"/>
<meta property="article:tag" content="baseball"/>
<meta property="og:image" content="../../theme/assets_images/gary-shear-comerica-park.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "2019-09-27 Riddler",
  "headline": "2019-09-27 Riddler",
  "datePublished": "2019-09-29 14:48:00-04:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Jordy Nelson",
    "url": "../../author/jordy-nelson"
  },
  "image": "../../theme/assets_images/gary-shear-comerica-park.jpg",
  "url": "../../2019/09/riddler-2019-09-27.html",
  "description": "Who will win the Riddler Fall Classic?"
}
</script>
</head>
<!-- TODO : Body class -->

<body class="home-template loading">
  <div class="spinner">
    <div class="sk-wandering-cubes">
      <div class="sk-cube sk-cube1"></div>
      <div class="sk-cube sk-cube2"></div>
    </div>
  </div>

  <!-- ##### gtm ##### -->
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJN5JZ6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <div class="nav-label">
        <div class="nav-home">
          <a class="nav-home-link" href="../../">
            <div class="nav-home-link-icon"></div>
          </a>
        </div>
      </div>
    <ul>
          <li role="presentation" class="">
            <a href ="/index.html">
              home
            </a>
          </li>
          <li role="presentation" class="">
            <a href ="/pages/about.html">
              about
            </a>
          </li>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
          <!--
            <span id="home-button" class="nav-button">
                <a class="home-button" href="../../" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          -->
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">2019-09-27 Riddler</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="../../author/jordy-nelson">Jordy Nelson</a>
            | <time datetime="29 Sep 2019">29 Sep 2019</time>
        </span>
        <!-- TODO : Modified check -->
            <div class="post-cover cover" style="background-image: url('../../theme/assets_images/gary-shear-comerica-park.jpg')">
      </div>
    </header>
    <!-- ##### begin cover photo credits ##### -->
    <div class="cover-credits">
      <div class="inner">
        <span>
          Gary Shear/Unsplash
        </span>
      </div>
    </div>
    <!-- ##### end cover photo credits ##### -->

  <section id="wrapper">
    <a class="hidden-close"></a>
    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>This past weekend's <a href="https://fivethirtyeight.com/features/which-baseball-team-will-win-the-riddler-fall-classic/">Riddler Classic</a> pits three baseball teams against one another in a Goldilocks-esque showdown. In the Riddler Baseball League, does it pay to stack your team with infrequent sluggers? Frequent pitch magnets? Or take a tack somewhere down the middle with a jacks-of-all-bases team? </p>
<blockquote>
<p>Riddler League Baseball, also known as the RLB, consists of three teams: the Mississippi Moonwalkers, the Delaware Doubloons and the Tennessee Taters.</p>
<p>Each time a batter for the Moonwalkers comes to the plate, they have a 40 percent chance of getting a walk and a 60 percent chance of striking out. Each batter for the Doubloons, meanwhile, hits a double 20 percent percent of the time, driving in any teammates who are on base, and strikes out the remaining 80 percent of the time. Finally, each batter for the Taters has a 10 percent chance of hitting a home run and a 90 percent chance of striking out.</p>
<p>During the RLB season, each team plays an equal number of games against each opponent. Games are nine innings long and can go into extra innings just like in other baseball leagues. Which of the three teams is most likely to have the best record at the end of the season?</p>
</blockquote>
<p>Let's first summarize the probabilities and values of success (as success is in the eye of the batter) for each team:</p>
<table>
<thead>
<tr>
<th align="center">Team</th>
<th align="center">Success Prob</th>
<th align="center">Failure Prob</th>
<th align="center">Success Value</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Moonwalkers</td>
<td align="center">40%</td>
<td align="center">60%</td>
<td align="center">0.250</td>
</tr>
<tr>
<td align="center">Doubloons</td>
<td align="center">20%</td>
<td align="center">80%</td>
<td align="center">0.50</td>
</tr>
<tr>
<td align="center">Taters</td>
<td align="center">10%</td>
<td align="center">90%</td>
<td align="center">1.00</td>
</tr>
</tbody>
</table>
<p>With these probabilities, we can generalize the expected number of successes for each team by describing the number of expected successes for each inning at bat; that is, we are interested in the number of successes before three strikeouts. The distribution that allows us to do this is the negative binomial distribution, which extends the geometric distribution and describes the number of <code>k</code> successes until a stopping criterion of <code>n</code> failures have been observed.</p>
<div class="highlight"><pre><span></span><code><span class="c1">##### ------------------------------------- #####</span>
<span class="c1">##### ------------------------------------- #####</span>
<span class="c1">##### distribution modeling of expectations #####</span>
<span class="c1">##### ------------------------------------- #####</span>
<span class="c1">##### ------------------------------------- #####</span>

<span class="c1">### ------------------ ###</span>
<span class="c1">### expected successes ###</span>
<span class="c1">### ------------------ ###</span>
<span class="n">expected_successes_cap</span> <span class="o">&lt;-</span> <span class="m">0</span><span class="o">:</span><span class="m">10</span>

<span class="n">moonwalkers_expected_successes_df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">team</span> <span class="o">=</span> <span class="s">&#39;Moonwalkers&#39;</span><span class="p">,</span>
                                                <span class="n">successes</span> <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span>
                                                <span class="n">prob</span> <span class="o">=</span> <span class="nf">dnbinom</span><span class="p">(</span><span class="n">x</span>    <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span> <span class="c1"># number of runs</span>
                                                               <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>                   <span class="c1"># end trial at 3 strikeouts</span>
                                                               <span class="n">prob</span> <span class="o">=</span> <span class="m">0.6</span><span class="p">))</span> <span class="o">%&gt;%</span>            <span class="c1"># probability of strikeout)</span>
  <span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.factor</span><span class="p">,</span> <span class="n">as.character</span><span class="p">)</span>

<span class="n">doubloons_expected_successes_df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">team</span> <span class="o">=</span> <span class="s">&#39;Doubloons&#39;</span><span class="p">,</span>
                                              <span class="n">successes</span> <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span>
                                              <span class="n">prob</span> <span class="o">=</span> <span class="nf">dnbinom</span><span class="p">(</span><span class="n">x</span>    <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span> <span class="c1"># number of runs</span>
                                                             <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>                   <span class="c1"># end trial at 3 strikeouts</span>
                                                             <span class="n">prob</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">))</span> <span class="o">%&gt;%</span>            <span class="c1"># probability of strikeout)</span>
  <span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.factor</span><span class="p">,</span> <span class="n">as.character</span><span class="p">)</span>

<span class="n">taters_expected_successes_df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">team</span> <span class="o">=</span> <span class="s">&#39;Taters&#39;</span><span class="p">,</span>
                                           <span class="n">successes</span> <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span>
                                           <span class="n">prob</span> <span class="o">=</span> <span class="nf">dnbinom</span><span class="p">(</span><span class="n">x</span>    <span class="o">=</span> <span class="n">expected_successes_cap</span><span class="p">,</span> <span class="c1"># number of runs</span>
                                                          <span class="n">size</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>                   <span class="c1"># end trial at 3 strikeouts</span>
                                                          <span class="n">prob</span> <span class="o">=</span> <span class="m">0.9</span><span class="p">))</span> <span class="o">%&gt;%</span>            <span class="c1"># probability of strikeout)</span>
  <span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.factor</span><span class="p">,</span> <span class="n">as.character</span><span class="p">)</span>

<span class="n">expected_successes_df</span> <span class="o">&lt;-</span> <span class="n">moonwalkers_expected_successes_df</span> <span class="o">%&gt;%</span>
  <span class="nf">rbind</span><span class="p">(</span><span class="n">doubloons_expected_successes_df</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">rbind</span><span class="p">(</span><span class="n">taters_expected_successes_df</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">runs</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">team</span> <span class="o">==</span> <span class="s">&#39;Moonwalkers&#39;</span><span class="p">,</span>
                       <span class="c1"># moonwalkers runs</span>
                       <span class="n">successes</span> <span class="o">*</span> <span class="m">0.25</span><span class="p">,</span>
                       <span class="nf">ifelse</span><span class="p">(</span><span class="n">team</span> <span class="o">==</span> <span class="s">&#39;Doubloons&#39;</span><span class="p">,</span>
                              <span class="c1"># doubloons runs</span>
                              <span class="n">successes</span> <span class="o">*</span> <span class="m">0.50</span><span class="p">,</span>
                              <span class="c1"># taters runs</span>
                              <span class="n">successes</span> <span class="o">*</span> <span class="m">1.00</span><span class="p">)))</span>

<span class="n">expected_successes_df</span> <span class="o">%&gt;%</span>
  <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span>        <span class="o">=</span> <span class="n">successes</span><span class="p">,</span>
             <span class="n">y</span>        <span class="o">=</span> <span class="n">prob</span><span class="p">,</span>
             <span class="n">group</span>    <span class="o">=</span> <span class="n">team</span><span class="p">,</span>
             <span class="n">fill</span>     <span class="o">=</span> <span class="n">team</span><span class="p">,</span>
             <span class="n">colour</span>   <span class="o">=</span> <span class="n">team</span><span class="p">,</span>
             <span class="n">linetype</span> <span class="o">=</span> <span class="n">team</span><span class="p">))</span> <span class="o">+</span>
  <span class="nf">geom_density</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s">&#39;identity&#39;</span><span class="p">,</span>
               <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
  <span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">scales</span><span class="o">::</span><span class="nf">pretty_breaks</span><span class="p">())</span> <span class="o">+</span>
  <span class="nf">theme_bw</span><span class="p">()</span> <span class="o">+</span>
  <span class="nf">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="s">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">legend.text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
        <span class="n">plot.title</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">16</span><span class="p">,</span> <span class="n">face</span><span class="o">=</span><span class="s">&#39;bold&#39;</span><span class="p">,</span> <span class="n">vjust</span><span class="o">=</span><span class="m">2</span><span class="p">),</span>
        <span class="n">axis.title.x</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
        <span class="n">axis.title.y</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
        <span class="n">axis.text</span><span class="o">=</span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">),</span>
        <span class="n">panel.border</span><span class="o">=</span><span class="nf">element_blank</span><span class="p">())</span> <span class="o">+</span>
  <span class="nf">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span> <span class="s">&#39;Expected Successes X Team&#39;</span><span class="p">,</span>
       <span class="n">x</span> <span class="o">=</span> <span class="s">&#39;Expected Successes&#39;</span><span class="p">,</span>
       <span class="n">y</span> <span class="o">=</span> <span class="s">&#39;Probability&#39;</span><span class="p">)</span>
</code></pre></div>


<p><img alt="Riddler 2019-09-30 Plot" src="../../theme/assets_images/riddler-2019-09-27-plot-1.png" title="Riddler 2019-09-30 Plot"></p>
<p>This helps us visualize our intuition from the table above: this is a competition between the infrequent-but-high-value Taters, the frequent-but-low-value Moonwalkers, and the Goldilocks Doubloons. </p>
<p>But those are just the expected successes, though -- not runs. </p>
<p>We could extend expected successes to runs. Or we could just go ahead and simulate a season.</p>
<p>First we'll get things prepared:</p>
<div class="highlight"><pre><span></span><code><span class="c1">##### ----------------- #####</span>
<span class="c1">##### ----------------- #####</span>
<span class="c1">##### clean environment #####</span>
<span class="c1">##### ----------------- #####</span>
<span class="c1">##### ----------------- #####</span>
<span class="nf">rm</span><span class="p">(</span><span class="n">list</span><span class="o">=</span><span class="nf">ls</span><span class="p">())</span>
<span class="nf">gc</span><span class="p">()</span>

<span class="c1">##### -------------- #####</span>
<span class="c1">##### -------------- #####</span>
<span class="c1">##### load libraries #####</span>
<span class="c1">##### -------------- #####</span>
<span class="c1">##### -------------- #####</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">progress</span><span class="p">)</span>

<span class="c1">##### ------------- #####</span>
<span class="c1">##### ------------- #####</span>
<span class="c1">##### config params #####</span>
<span class="c1">##### ------------- #####</span>
<span class="c1">##### ------------- #####</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>

<span class="n">teams_list</span> <span class="o">&lt;-</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;Moonwalkers&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">outcomes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;pos&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                                                                     <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.4</span><span class="p">),</span>
                                                        <span class="s">&#39;neg&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">0</span><span class="p">,</span>
                                                                     <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.6</span><span class="p">))),</span>
                   <span class="s">&#39;Doubloons&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">outcomes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;pos&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">2</span><span class="p">,</span>
                                                                   <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">),</span>
                                                      <span class="s">&#39;neg&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">0</span><span class="p">,</span>
                                                                   <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">))),</span>
                   <span class="s">&#39;Taters&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">outcomes</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;pos&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">4</span><span class="p">,</span>
                                                                <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.1</span><span class="p">),</span>
                                                   <span class="s">&#39;neg&#39;</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="s">&#39;val&#39;</span>      <span class="o">=</span> <span class="m">0</span><span class="p">,</span>
                                                                <span class="s">&#39;prob_for&#39;</span> <span class="o">=</span> <span class="m">0.9</span><span class="p">))))</span>

<span class="n">n_games</span> <span class="o">&lt;-</span> <span class="m">1e5</span> <span class="c1"># number of games each team will play against each other team</span>
</code></pre></div>


<p>Then we'll define the functions that will help us simulate an entire season:</p>
<div class="highlight"><pre><span></span><code><span class="c1">##### ------------------------- #####</span>
<span class="c1">##### ------------------------- #####</span>
<span class="c1">##### def funs to simulate game #####</span>
<span class="c1">##### ------------------------- #####</span>
<span class="c1">##### ------------------------- #####</span>

<span class="c1">### ---------------------- ###</span>
<span class="c1">### fun to simulate at-bat ###</span>
<span class="c1">### ---------------------- ###</span>
<span class="n">bat</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">team</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># prob of positive outcome</span>
  <span class="n">prob_for</span>     <span class="o">&lt;-</span> <span class="n">teams_list</span><span class="p">[[</span><span class="n">team</span><span class="p">]]</span><span class="o">$</span><span class="n">outcomes</span><span class="o">$</span><span class="n">pos</span><span class="o">$</span><span class="n">prob_for</span>
  <span class="n">prob_against</span> <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">-</span> <span class="n">prob_for</span>

  <span class="c1"># outcome</span>
  <span class="n">res</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="n">x</span>       <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span>
                <span class="n">size</span>    <span class="o">=</span> <span class="m">1</span><span class="p">,</span>
                <span class="n">replace</span> <span class="o">=</span> <span class="bp">F</span><span class="p">,</span>
                <span class="n">prob</span>    <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="n">prob_against</span><span class="p">,</span> <span class="n">prob_for</span><span class="p">))</span>

  <span class="c1"># return</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="p">}</span>

<span class="c1">### -------------------------------------- ###</span>
<span class="c1">### fun to translate outcomes into results ###</span>
<span class="c1">### -------------------------------------- ###</span>
<span class="n">outcomes_trans</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">half_inning_res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># val of positive outcome</span>
  <span class="n">val</span>  <span class="o">&lt;-</span> <span class="n">teams_list</span><span class="p">[[</span><span class="n">team</span><span class="p">]]</span><span class="o">$</span><span class="n">outcomes</span><span class="o">$</span><span class="n">pos</span><span class="o">$</span><span class="n">val</span>

  <span class="c1"># translate value into runs (four bases)</span>
  <span class="n">runs_trans_val</span> <span class="o">&lt;-</span> <span class="n">val</span> <span class="o">/</span> <span class="m">4</span>

  <span class="c1"># get half-inning value</span>
  <span class="n">half_inning_val</span> <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="n">half_inning_res</span><span class="p">)</span> <span class="o">*</span> <span class="n">runs_trans_val</span>

  <span class="c1"># round down to account for runners stranded on bases</span>
  <span class="n">half_inning_val</span> <span class="o">&lt;-</span> <span class="nf">floor</span><span class="p">(</span><span class="n">half_inning_val</span><span class="p">)</span>

  <span class="c1"># return</span>
  <span class="nf">return</span><span class="p">(</span><span class="n">half_inning_val</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">### ----------------------------------------- ###</span>
<span class="c1">### fun to simulate half inning (team at bat) ###</span>
<span class="c1">### ----------------------------------------- ###</span>
<span class="n">half_inning</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">bat_res</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># init</span>
  <span class="nf">if</span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">bat_res</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1"># init bat_res vec</span>
    <span class="n">bat_res</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="c1"># simulate at-bat</span>
  <span class="n">bat_out</span> <span class="o">&lt;-</span> <span class="nf">bat</span><span class="p">(</span><span class="n">team</span><span class="p">)</span>

  <span class="c1"># update bat_res</span>
  <span class="n">bat_res</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">bat_res</span><span class="p">,</span> <span class="n">bat_out</span><span class="p">)</span>

  <span class="c1"># break case = bat_res contains three zeroes (strike-outs)</span>
  <span class="nf">if</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">bat_res</span><span class="p">[</span><span class="n">bat_res</span> <span class="o">==</span> <span class="m">0</span><span class="p">])</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># translate outcome to runs</span>
    <span class="n">inning_out</span>   <span class="o">&lt;-</span> <span class="nf">sum</span><span class="p">(</span><span class="n">bat_res</span><span class="p">)</span>
    <span class="n">inning_runs</span> <span class="o">&lt;-</span> <span class="nf">outcomes_trans</span><span class="p">(</span><span class="n">team</span><span class="p">,</span> <span class="n">inning_out</span><span class="p">)</span>

    <span class="nf">return</span><span class="p">(</span><span class="n">inning_runs</span><span class="p">)</span>

  <span class="p">}</span> <span class="n">else</span> <span class="p">{</span>
    <span class="c1"># return score</span>
    <span class="nf">return</span><span class="p">(</span><span class="nf">half_inning</span><span class="p">(</span><span class="n">team</span> <span class="o">=</span> <span class="n">team</span><span class="p">,</span> <span class="n">bat_res</span> <span class="o">=</span> <span class="n">bat_res</span><span class="p">))</span>  
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">### -------------------- ###</span>
<span class="c1">### fun to simulate game ###</span>
<span class="c1">### -------------------- ###</span>
<span class="n">game</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">team1</span><span class="p">,</span> <span class="n">team2</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1"># -------------------- #</span>
  <span class="c1"># init innings counter #</span>
  <span class="c1"># -------------------- #</span>
  <span class="n">innings_counter</span> <span class="o">&lt;-</span> <span class="m">9</span>

  <span class="c1"># ----------------- #</span>
  <span class="c1"># get 9 innings val #</span>
  <span class="c1"># ----------------- #</span>

  <span class="c1"># init scores</span>
  <span class="n">team1_score</span> <span class="o">&lt;-</span> <span class="m">0L</span>
  <span class="n">team2_score</span> <span class="o">&lt;-</span> <span class="m">0L</span>

  <span class="c1"># simulate regular game</span>
  <span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="m">9</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">inning_score_team1</span> <span class="o">&lt;-</span> <span class="nf">half_inning</span><span class="p">(</span><span class="n">team1</span><span class="p">)</span>
    <span class="n">inning_score_team2</span> <span class="o">&lt;-</span> <span class="nf">half_inning</span><span class="p">(</span><span class="n">team2</span><span class="p">)</span>

    <span class="n">team1_score</span>  <span class="o">&lt;-</span> <span class="n">team1_score</span> <span class="o">+</span> <span class="n">inning_score_team1</span>
    <span class="n">team2_score</span>  <span class="o">&lt;-</span> <span class="n">team2_score</span> <span class="o">+</span> <span class="n">inning_score_team2</span>
  <span class="p">}</span>

  <span class="c1"># ------------------------------------------------- #</span>
  <span class="c1"># if tied, simulate extra innings until a team wins #</span>
  <span class="c1"># ------------------------------------------------- #</span>
  <span class="nf">while</span><span class="p">(</span><span class="n">team1_score</span> <span class="o">==</span> <span class="n">team2_score</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># update team1 score for extra inning</span>
    <span class="n">team1_extra_inning_score</span> <span class="o">&lt;-</span> <span class="nf">half_inning</span><span class="p">(</span><span class="n">team1</span><span class="p">)</span>
    <span class="n">team1_score</span>              <span class="o">&lt;-</span> <span class="n">team1_score</span> <span class="o">+</span> <span class="n">team1_extra_inning_score</span>

    <span class="c1"># update team2 score for extra inning</span>
    <span class="n">team2_extra_inning_score</span> <span class="o">&lt;-</span> <span class="nf">half_inning</span><span class="p">(</span><span class="n">team2</span><span class="p">)</span>
    <span class="n">team2_score</span>              <span class="o">&lt;-</span> <span class="n">team2_score</span> <span class="o">+</span> <span class="n">team2_extra_inning_score</span>

    <span class="n">innings_counter</span> <span class="o">&lt;-</span> <span class="n">innings_counter</span> <span class="o">+</span> <span class="m">1</span>

  <span class="p">}</span>

  <span class="c1"># ------ #</span>
  <span class="c1"># return #</span>
  <span class="c1"># ------ #</span>
  <span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="s">&#39;team1_score&#39;</span> <span class="o">=</span> <span class="n">team1_score</span><span class="p">,</span>
              <span class="s">&#39;team2_score&#39;</span> <span class="o">=</span> <span class="n">team2_score</span><span class="p">,</span>
              <span class="s">&#39;n_innings&#39;</span>   <span class="o">=</span> <span class="n">innings_counter</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div>


<p>And now we'll put it all together in a simulation:</p>
<div class="highlight"><pre><span></span><code><span class="c1">##### --------------- #####</span>
<span class="c1">##### --------------- #####</span>
<span class="c1">##### simulate season #####</span>
<span class="c1">##### --------------- #####</span>
<span class="c1">##### --------------- #####</span>

<span class="c1">### -------------------- ###</span>
<span class="c1">### config season params ###</span>
<span class="c1">### -------------------- ###</span>

<span class="c1"># ------------------------------------------ #</span>
<span class="c1"># get matchups (unordered 2-tuples of teams) #</span>
<span class="c1"># ------------------------------------------ #</span>
<span class="n">season_matchups_list</span> <span class="o">&lt;-</span> <span class="nf">combn</span><span class="p">(</span><span class="n">x</span>        <span class="o">=</span> <span class="nf">names</span><span class="p">(</span><span class="n">teams_list</span><span class="p">),</span>
                              <span class="n">m</span>        <span class="o">=</span> <span class="m">2</span><span class="p">,</span>
                              <span class="n">simplify</span> <span class="o">=</span> <span class="bp">F</span><span class="p">)</span>

<span class="c1">### ------------------------------------------ ###</span>
<span class="c1">### populate season_res_df with season results ###</span>
<span class="c1">### ------------------------------------------ ###</span>

<span class="c1"># ------------------ #</span>
<span class="c1"># init season_res_df #</span>
<span class="c1"># ------------------ #</span>
<span class="n">season_res_df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">matchup_game</span> <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n_games</span><span class="p">,</span> <span class="nf">length</span><span class="p">(</span><span class="n">season_matchups_list</span><span class="p">)),</span>
                            <span class="n">team_1</span>       <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">unlist</span><span class="p">(</span><span class="n">season_matchups_list</span><span class="p">)[</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="bp">T</span><span class="p">,</span> <span class="bp">F</span><span class="p">),</span> 
                                                                                  <span class="nf">length</span><span class="p">(</span><span class="nf">unlist</span><span class="p">(</span><span class="n">season_matchups_list</span><span class="p">))</span> <span class="o">/</span> <span class="m">2</span><span class="p">)]),</span>
                                               <span class="n">n_games</span><span class="p">),</span>
                            <span class="n">team_2</span>       <span class="o">=</span> <span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="nf">unlist</span><span class="p">(</span><span class="n">season_matchups_list</span><span class="p">)[</span><span class="nf">rep</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="bp">F</span><span class="p">,</span> <span class="bp">T</span><span class="p">),</span> 
                                                                                  <span class="nf">length</span><span class="p">(</span><span class="nf">unlist</span><span class="p">(</span><span class="n">season_matchups_list</span><span class="p">))</span> <span class="o">/</span> <span class="m">2</span><span class="p">)]),</span>
                                               <span class="n">n_games</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.factor</span><span class="p">,</span> <span class="n">as.character</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">rowwise</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">team_tuple</span> <span class="o">=</span> <span class="nf">paste0</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">team_1</span><span class="p">,</span> <span class="n">team_2</span><span class="p">),</span> <span class="n">collapse</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">arrange</span><span class="p">(</span><span class="n">team_tuple</span><span class="p">)</span>

<span class="c1">### -------------- ###</span>
<span class="c1">### simulate games ###</span>
<span class="c1">### -------------- ###</span>
<span class="n">unique_matchups</span> <span class="o">&lt;-</span> <span class="nf">unique</span><span class="p">(</span><span class="n">season_res_df</span><span class="o">$</span><span class="n">team_tuple</span><span class="p">)</span>

<span class="n">pb</span> <span class="o">&lt;-</span> <span class="n">progress_bar</span><span class="o">$</span><span class="nf">new</span><span class="p">(</span>
  <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;simulating games (:spin) [:bar] :percent eta: :eta&#39;</span><span class="p">,</span>
  <span class="n">total</span> <span class="o">=</span> <span class="n">n_games</span> <span class="o">*</span> <span class="nf">length</span><span class="p">(</span><span class="n">unique_matchups</span><span class="p">),</span> <span class="n">clear</span> <span class="o">=</span> <span class="kc">FALSE</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span> <span class="m">80</span><span class="p">)</span>

<span class="c1"># ------------------------- #</span>
<span class="c1"># init vecs to hold results #</span>
<span class="c1"># ------------------------- #</span>
<span class="n">matchups_score_team_1_vec</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
<span class="n">matchups_score_team_2_vec</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
<span class="n">matchups_winning_team_vec</span> <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>
<span class="n">matchups_n_innings_vec</span>    <span class="o">&lt;-</span> <span class="nf">vector</span><span class="p">()</span>

<span class="nf">for</span><span class="p">(</span><span class="n">i</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">unique_matchups</span><span class="p">))</span> <span class="p">{</span>

  <span class="c1"># ---------------- #</span>
  <span class="c1"># get curr matchup #</span>
  <span class="c1"># ---------------- #</span>
  <span class="n">curr_matchup</span> <span class="o">&lt;-</span> <span class="n">unique_matchups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

  <span class="n">curr_teams</span> <span class="o">&lt;-</span> <span class="nf">str_split</span><span class="p">(</span><span class="n">string</span>  <span class="o">=</span> <span class="n">curr_matchup</span><span class="p">,</span>
                          <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;\\|&#39;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span>

  <span class="n">curr_team_1</span> <span class="o">&lt;-</span> <span class="n">curr_teams</span><span class="p">[</span><span class="m">1</span><span class="p">]</span>
  <span class="n">curr_team_2</span> <span class="o">&lt;-</span> <span class="n">curr_teams</span><span class="p">[</span><span class="m">2</span><span class="p">]</span>

  <span class="c1"># ------------------------------- #</span>
  <span class="c1"># simulate games for curr_matchup #</span>
  <span class="c1"># and update vectors with results #</span>
  <span class="c1"># ------------------------------- #</span>
  <span class="nf">for</span><span class="p">(</span><span class="n">j</span> <span class="n">in</span> <span class="m">1</span><span class="o">:</span><span class="n">n_games</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># ------------- #</span>
    <span class="c1"># simulate game #</span>
    <span class="c1"># ------------- #</span>
    <span class="n">curr_matchup_game_res</span> <span class="o">&lt;-</span> <span class="nf">game</span><span class="p">(</span><span class="n">curr_team_1</span><span class="p">,</span> <span class="n">curr_team_2</span><span class="p">)</span>

    <span class="c1"># ---------------- #</span>
    <span class="c1"># get game results #</span>
    <span class="c1"># ---------------- #</span>
    <span class="n">curr_matchup_game_score_team_1</span> <span class="o">&lt;-</span> <span class="n">curr_matchup_game_res</span><span class="o">$</span><span class="n">team1_score</span>
    <span class="n">curr_matchup_game_score_team_2</span> <span class="o">&lt;-</span> <span class="n">curr_matchup_game_res</span><span class="o">$</span><span class="n">team2_score</span>
    <span class="n">curr_matchup_game_n_innings</span>    <span class="o">&lt;-</span> <span class="n">curr_matchup_game_res</span><span class="o">$</span><span class="n">n_innings</span>

    <span class="n">curr_matchup_game_winner</span>       <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">curr_matchup_game_score_team_1</span> <span class="o">&gt;</span> <span class="n">curr_matchup_game_score_team_2</span><span class="p">,</span>
                                             <span class="n">curr_team_1</span><span class="p">,</span>
                                             <span class="n">curr_team_2</span><span class="p">)</span>

    <span class="c1"># ----------------------------- #</span>
    <span class="c1"># update running matchup totals #</span>
    <span class="c1"># ----------------------------- #</span>
    <span class="n">matchups_score_team_1_vec</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matchups_score_team_1_vec</span><span class="p">,</span>
                                   <span class="n">curr_matchup_game_score_team_1</span><span class="p">)</span>

    <span class="n">matchups_score_team_2_vec</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matchups_score_team_2_vec</span><span class="p">,</span>
                                   <span class="n">curr_matchup_game_score_team_2</span><span class="p">)</span>

    <span class="n">matchups_winning_team_vec</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matchups_winning_team_vec</span><span class="p">,</span>
                                   <span class="n">curr_matchup_game_winner</span><span class="p">)</span>

    <span class="n">matchups_n_innings_vec</span>    <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="n">matchups_n_innings_vec</span><span class="p">,</span>
                                   <span class="n">curr_matchup_game_n_innings</span><span class="p">)</span>

    <span class="c1"># ------------------ #</span>
    <span class="c1"># increment progress #</span>
    <span class="c1"># ------------------ #</span>
    <span class="n">pb</span><span class="o">$</span><span class="nf">tick</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">### -------------------- ###</span>
<span class="c1">### update season_res_df ###</span>
<span class="c1">### -------------------- ###</span>
<span class="n">season_res_df</span><span class="o">$</span><span class="n">score_team_1</span> <span class="o">&lt;-</span> <span class="n">matchups_score_team_1_vec</span>
<span class="n">season_res_df</span><span class="o">$</span><span class="n">score_team_2</span> <span class="o">&lt;-</span> <span class="n">matchups_score_team_2_vec</span>
<span class="n">season_res_df</span><span class="o">$</span><span class="n">winner</span>       <span class="o">&lt;-</span> <span class="n">matchups_winning_team_vec</span>
<span class="n">season_res_df</span><span class="o">$</span><span class="n">n_innings</span>    <span class="o">&lt;-</span> <span class="n">matchups_n_innings_vec</span>

<span class="c1">### ------------- ###</span>
<span class="c1">### tally results ###</span>
<span class="c1">### ------------- ###</span>
<span class="n">season_matchup_res_df</span> <span class="o">&lt;-</span> <span class="n">season_res_df</span> <span class="o">%&gt;%</span>
  <span class="nf">group_by</span><span class="p">(</span><span class="n">team_tuple</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">summarise</span><span class="p">(</span><span class="n">n_games</span> <span class="o">=</span> <span class="nf">n</span><span class="p">(),</span>
            <span class="n">team_1_wins</span>    <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="n">.</span><span class="o">$</span><span class="n">team_tuple</span> <span class="o">==</span> <span class="n">team_tuple</span> <span class="o">&amp;</span> <span class="n">.</span><span class="o">$</span><span class="n">score_team_1</span> <span class="o">&gt;</span> <span class="n">.</span><span class="o">$</span><span class="n">score_team_2</span><span class="p">,</span> <span class="p">]),</span>
            <span class="n">team_2_wins</span>    <span class="o">=</span> <span class="nf">nrow</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="n">.</span><span class="o">$</span><span class="n">team_tuple</span> <span class="o">==</span> <span class="n">team_tuple</span> <span class="o">&amp;</span> <span class="n">.</span><span class="o">$</span><span class="n">score_team_1</span> <span class="o">&lt;</span> <span class="n">.</span><span class="o">$</span><span class="n">score_team_2</span><span class="p">,</span> <span class="p">]),</span>
            <span class="n">mean_n_innings</span> <span class="o">=</span> <span class="nf">mean</span><span class="p">(</span><span class="n">n_innings</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">team_1_avg</span> <span class="o">=</span> <span class="n">team_1_wins</span> <span class="o">/</span> <span class="p">(</span><span class="n">team_1_wins</span> <span class="o">+</span> <span class="n">team_2_wins</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">team_2_avg</span> <span class="o">=</span> <span class="n">team_2_wins</span> <span class="o">/</span> <span class="p">(</span><span class="n">team_1_wins</span> <span class="o">+</span> <span class="n">team_2_wins</span><span class="p">))</span>


<span class="n">season_team_res_df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">team</span> <span class="o">=</span> <span class="nf">unique</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">season_res_df</span><span class="o">$</span><span class="n">team_1</span><span class="p">,</span> <span class="n">season_res_df</span><span class="o">$</span><span class="n">team_2</span><span class="p">)))</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate_if</span><span class="p">(</span><span class="n">is.factor</span><span class="p">,</span> <span class="n">as.character</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">n_games</span> <span class="o">=</span> <span class="n">n_games</span> <span class="o">*</span> <span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">teams_list</span><span class="p">))</span> <span class="o">-</span> <span class="m">1</span><span class="p">))</span> <span class="o">%&gt;%</span>
  <span class="nf">rowwise</span><span class="p">()</span> <span class="o">%&gt;%</span>
  <span class="nf">mutate</span><span class="p">(</span><span class="n">n_wins</span>   <span class="o">=</span> <span class="n">season_res_df</span><span class="p">[(</span><span class="n">season_res_df</span><span class="o">$</span><span class="n">winner</span> <span class="o">==</span> <span class="n">team</span><span class="p">),</span> <span class="p">]</span> <span class="o">%&gt;%</span> <span class="nf">nrow</span><span class="p">(),</span>
         <span class="n">win_rate</span> <span class="o">=</span> <span class="n">n_wins</span> <span class="o">/</span> <span class="n">n_games</span><span class="p">)</span>
</code></pre></div>


<p>And with the final runs of the seemingly never-ending Riddler Fall Classic tallied, we have the following:</p>
<table>
<thead>
<tr>
<th align="left">team</th>
<th align="right">n_games</th>
<th align="right">n_wins</th>
<th align="right">win_rate</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Doubloons</td>
<td align="right">200000</td>
<td align="right">79530</td>
<td align="right">0.39765</td>
</tr>
<tr>
<td align="left">Moonwalkers</td>
<td align="right">200000</td>
<td align="right">75752</td>
<td align="right">0.37876</td>
</tr>
<tr>
<td align="left">Taters</td>
<td align="right">200000</td>
<td align="right">144718</td>
<td align="right">0.72359</td>
</tr>
</tbody>
</table>
<p>And the specific matchups:</p>
<table>
<thead>
<tr>
<th align="left">team_tuple</th>
<th align="right">n_games</th>
<th align="right">team_1_wins</th>
<th align="right">team_2_wins</th>
<th align="right">mean_n_innings</th>
<th align="right">team_1_avg</th>
<th align="right">team_2_avg</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Doubloons&#124;Taters</td>
<td align="right">100000</td>
<td align="right">28360</td>
<td align="right">71640</td>
<td align="right">9.44457</td>
<td align="right">0.28360</td>
<td align="right">0.71640</td>
</tr>
<tr>
<td align="left">Moonwalkers&#124;Doubloons</td>
<td align="right">100000</td>
<td align="right">48830</td>
<td align="right">51170</td>
<td align="right">9.73793</td>
<td align="right">0.48830</td>
<td align="right">0.51170</td>
</tr>
<tr>
<td align="left">Moonwalkers&#124;Taters</td>
<td align="right">100000</td>
<td align="right">26922</td>
<td align="right">73078</td>
<td align="right">9.44819</td>
<td align="right">0.26922</td>
<td align="right">0.73078</td>
</tr>
</tbody>
</table>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=2019-09-27 Riddler&amp;url=../../2019/09/riddler-2019-09-27.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=../../2019/09/riddler-2019-09-27.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=../../2019/09/riddler-2019-09-27.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="../../tag/fivethirtyeight">FiveThirtyEight</a><a href="../../tag/riddler">Riddler</a><a href="../../tag/r">R</a><a href="../../tag/probability">probability</a><a href="../../tag/negative-binomial">negative binomial</a><a href="../../tag/simulation">simulation</a><a href="../../tag/baseball">baseball</a>                </aside>

                <div class="clear"></div>


                </section>

                <!-- ##### begin disqus comments ##### -->
                <script>
                /**
                *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
                
                /**/
                var disqus_config = function () {
                this.page.url = '../../2019/09/riddler-2019-09-27.html';  // Replace PAGE_URL with your page's canonical URL variable
                this.page.identifier = '2019/09/riddler-2019-09-27.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                };
                /**/

                (function() { // DON'T EDIT BELOW THIS LINE
                var d = document, s = d.createElement('script');
                s.src = 'https://jordynelson.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
                })();
                </script>
                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                <section class="post-comments">
                      <a id="show-disqus" class="post-comments-activate" data-disqus-identifier="2019/09/riddler-2019-09-27.html" >Show Comments</a>
                  <div id="disqus_thread"></div>
                </section>
                <!-- ##### end disqus comments ##### -->

                <!-- ##### begin neighbors prev and next articles ##### -->
                <aside class="post-nav">
                    <a class="post-nav-next" href="../../2019/10/riddler-2019-10-04.html">
                        <section class="post-nav-teaser" style="background: url(../../theme/assets_images/NeONBRAND-dollar-unsplash.jpg); background-size: cover; background-repeat: no-repeat;">
                            <i class="ic ic-arrow-left"></i>
                            <div class="post-nav-text">
                              <h2 class="post-nav-title">2019-10-04 Riddler</h2>
                              <p class="post-nav-excerpt">Should we lock in our answer for $1MM?</p>
                            </div>
                        </section>
                    </a>
                    <a class="post-nav-prev" href="../../2019/04/riddler-2019-04-05.html">
                        <section class="post-nav-teaser" style="background: url(../../theme/assets_images/karl-fredrickson-35017-unsplash.jpg); background-size: cover; background-repeat: no-repeat;">
                            <i class="ic ic-arrow-right"></i>
                            <div class="post-nav-text">
                              <h2 class="post-nav-title">2019-04-05 Riddler</h2>
                              <p class="post-nav-excerpt">Are we out of free coffees?</p>
                            </div>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>
                <!-- ##### begin neighbors prev and next articles ##### -->

            </div>
        </article>
    </main>
    
  <!-- ##### begin disqus comment count script ##### -->
  <script id="dsq-count-scr" src="//jordynelson.disqus.com/count.js" async></script>
  <!-- ##### end disqus comment count script ##### -->    
    <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer" class="container-fluid">
      <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-4 text-center">
          <span id="credits-software" class="credits">Published with <a class="an-link" href="https://github.com/getpelican/pelican"
              rel="nofollow">Pelican</a></span>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-4 text-center">
          <span id="credits-locale" class="credits"><a class="an-link" href="http://madewithloveinbaltimore.org/" title="Made with  in Baltimore">Made
              with <i class="icon fa fa-heart"></i> in Baltimore</a></span>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-4 text-center">
          <span id="credits-theme" class="credits">Theme <a class="an-link" href="https://github.com/jordy248/jordy248"
              rel="nofollow">Martian</a></span>
        </div>
      </div>
      <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-4 text-center">
          <span id="credits-theme" class="credits">&copy; 2021 Jordy Nelson</span>
        </div>
        <div class="col-xs-12 col-sm-6 col-md-4 text-center">
          <div id="credits-social" class="credits">
            <span id="credits-social-linkedin" class="icon"><a href="https://www.linkedin.com/in/jordynelson/"><i class="fab fa-linkedin"></i></a></span>
            <span id="credits-social-github" class="icon"><a href="htts://github.com/jordy248"><i class="fab fa-github"></i></a></span>
          </div>
        </div>
      </div>
    </footer>
  </section>

  <script type="text/javascript" src="../../theme/js/script.js"></script>

  <!-- Script specified by the user -->
  <script type="text/javascript" src="../../theme/js/script.js"></script>
  <script type="text/javascript" src="../../theme/js/myscript.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-78411303-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-78411303-1', { 'anonymize_ip': true });
    </script>
</body>

</html>